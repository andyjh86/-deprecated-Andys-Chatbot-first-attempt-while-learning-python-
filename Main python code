import tkinter as tk
import requests
import torch
from transformers import AutoTokenizer, AutoModelForCausalLM

# Load the pre-trained model and tokenizer
tokenizer = AutoTokenizer.from_pretrained("microsoft/DialoGPT-medium")
model = AutoModelForCausalLM.from_pretrained("microsoft/DialoGPT-medium")

# this is where the mechanics are defined
def get_response(event=None):
    # Get the message from the entry box
    message = entry.get()
    # Insert the message in the text widget
    conversation.insert(tk.END, f"You: {message}\n")
    # Encode the user input
    input_text = message
    input_ids = tokenizer.encode(input_text, return_tensors="pt")
    attention_mask = input_ids.ne(tokenizer.eos_token_id)
    pad_token_id = tokenizer.pad_token_id
    # Generate a response
    response_ids = model.generate(input_ids, attention_mask=attention_mask, pad_token_id=pad_token_id, max_length = 50)
    response_text = tokenizer.decode(response_ids[0], skip_special_tokens=True)

    # Insert the response in the text widget
    conversation.insert(tk.END, f"Bot: {response_text}\n")
    # Clear the entry box
    entry.delete(0, tk.END)
    # Move the view to the end of the text widget
    conversation.see(tk.END)

# Create the main window
root = tk.Tk()
root.geometry("600x450")
root.title("Andy's Chatbot GUI")

# Create a Text widget to show the conversation history
conversation = tk.Text(root)
conversation.pack(expand=True, fill='both')

# Create an entry box
entry = tk.Entry(root)
entry.pack()

# Create a button
button = tk.Button(root, text="Get Response", command=get_response)
button.pack()

# bind the enter key to the entry box
root.bind('<Return>', get_response)

# Start the main event loop
root.mainloop()
